name: 钉钉机器人消息发送
description: 钉钉机器人消息发送

branding:
  icon: 'message-square'
  color: 'green'

inputs:
  token:
    description: '机器人令牌'
    required: true
  status:
    description: '执行状态(-1 启动 0 成功 1 失败)'
    required: true
    default: -1

runs:
  using: composite
  steps:
    - name: Sending Dingtalk Robot Message
      uses: wow-actions/dingtalk-notify@v1
      with:
        token: ${{ inputs.token }}
        msgtype: 'actionCard'
        content: |
          {
              "title": "CI任务${{ inputs.status < 0 && '启动' || (inputs.status == 0 && '执行成功' || '执行失败') }}通知",
              "text": "**CI任务<font color='${{ inputs.status < 0 && '#FF9900' || (inputs.status == 0 && '#33CC00' || '#FF3333') }}'>${{ inputs.status < 0 && '启动' || (inputs.status == 0 && '执行成功' || '执行失败') }}</font>通知**  \n  项目: **${{ github.repository }}**  \n  分支: **${{ github.ref_name }}**  \n  任务名: **${{ github.job }}**  \n  任务ID: **${{ github.run_id }}**  \n  执行人: **${{ github.triggering_actor }}**${{ inputs.status >= 0 && '  \n  **耗时**: 1分钟' || '' }}",
              "btnOrientation": "1",
              "btns": [{
                "title": "查看项目",
                "actionURL": "https://github.com/${{ github.repository }}"
              },{
                "title": "查看任务",
                "actionURL": "https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}"
              }]
          }
